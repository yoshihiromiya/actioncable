<!--<h1>Chat room</h1>-->

<!--
<div id="messages">
  <%= render @messages %>
</div>
-->
<div id="map"></div>
    <script type="text/javascript">
        function initMap() {
        var map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 39.701653, lng: 141.137014},
          zoom: 6
        });
        var infoWindow = new google.maps.InfoWindow({map: map});

        // Try HTML5 geolocation.
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            var pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };

            infoWindow.setPosition(pos);
            infoWindow.setContent('Location found.');
            map.setCenter(pos);
          }, function() {
            handleLocationError(true, infoWindow, map.getCenter());
          });
        } else {
          // Browser doesn't support Geolocation
          handleLocationError(false, infoWindow, map.getCenter());
        }
      }
    
/*
        $(document).ready(function () {
            loadMap();
        });

        function loadMap() {
            mapboxgl.accessToken = 'pk.eyJ1IjoiZWRpc29uLWlzaGliYXNoaSIsImEiOiJjajQzcWptcTgwMG1kMzNsZWNydmdsYmlvIn0.PN5asih8YKlVHf9LABUDWw';

            if (!mapboxgl.supported()) {
                alert('このブラウザではMapbox GLを表示することができません。違うブラウザをお試しください。');
            } else {
                map = new mapboxgl.Map({
                    container: 'map',
                    style: 'mapbox://styles/edison-ishibashi/cjatdt733k2t92so59p1a1tmh',
                    center: [141.028148, 37.421016],
                    zoom: 15
                });
                map.addControl(new mapboxgl.NavigationControl());
                map.addControl(new mapboxgl.ScaleControl({maxWidth: 80}));
            }
         
            datas = [];
            var data = {
                "type": "Feature",
                "geometry": {
                    "type": "Point",
                    "coordinates": [141.028148, 37.421016]
                },
                "properties": {
                    "name": "2772黒須　義信",
                    "status": "作業中",
                    "created": "2017-12-07 10:42:16",
                    "marker-symbol": "",
    
                    "direction": null,
                    "image": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAADUlJREFUeNrs3T9SI0kWx/FCi78cQe202+oTtORtRBvACZDMtUAnAE4AnIDiBAhDxlpUn6A1dhuj9dbbmhPs5oOnmWqFoKEys+pV5fcTUaGOmEGIyny/ykzVnywDAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADvs8cuSMPXr18P3MvUbYduG7ntgL2SjNJtK7c9uC1fLpclAZBW8UvhX1H0cNZum7kQKAiAdIr/lj2BLccuBBYEQL+Lf+xeHtkTeGFa8GHAfui1c3YBXiDTwXNGAP09+ksD/5c9gdfWAxgB9NeIXYBfGBIAQMIIAIAAAEAAACAAABAAAAgAAAQAAAIAAAEAgAAAQAAAIAAAEAAACAAABAAAAgAAAQCAAABAAAAgAAAQAAAIAAAEAAACAAABAIAAABDSflc+qD7q+jBL45l38ujmh+VymdNFkXwAuOK/ci9nibXNkfu7T93rxAVBSVdFklMAVwS3CRb/hox2HvVR30BaAeA6vhT+NPE2khA4p6siqQBwxX/kXq5ooidTdgGSCQBX/HLUu6V5/nSg+wTodwDofPdeOj3N83MIsAuQwgjg0W1DmgZILAB0xZ+hLpBaALDiDyQaAKz4A4kGACv+QKIBwIo/kPYIgBV/IMUAYMUfSDQAWPEHEg0AVvwBO/YbLv6YK/6F2+7ctloul6uG/hbZTtw2piuBAHi9YGKu+M9d0V83ueM0ZGTLdUrDqAZMAV4Ra8W/8eLfEQby++d0JxAAu4/+sVb887aLfysE1nQpEAA/F3+sFX+Z68+M7c8buhQIgL+KP9aKv9wkc2Jwf67oUiAAsugr/twpF7AaAJFX/GdNfM0HEAD1xVrxz3lYBmA4ACKu+BcGF/0AAqBS/LFW/NduO6a5AKMBEHnF/5hFP8BoAERe8Z+z6AcYDYDIK/6XLPoBtkcAsVb8F674L2giwGgARFzxlyE/K/6A1QCIuOIvi30zFv0AowEQ+a4+xyz6AUYDoIEV/4JmAQwGQOQVfzPX9gMEwG6xVvxlyM8ddQCrARBxxf/p2n4W/QCjARD5Pv4UP2A1ACKv+HNtP2A1ACKv+HNtP2A1ACKv+HNtP2B8BBBrxX+dcW0/YDcAIq/4c20/YDUAIq/4c20/YDUAIq/4c20/YDUAIq/4c20/YDUAIq/4c20/YHwEEGvFn2v7AcsBoIt+o0jvz7X9gPERwGmk9y64th+wHwDDSO/No7KBjqwBxMDQH0g1ANzwf83uBdIdAQAgAAAQAADSCQA9uxBAoiOAUYL7k9ADAaBOEtyfh3QpEADPpnqFYRLc3zrO4t1HAehcAIhbVxjDBIpfgu6e7oSu2Y/8/lIY312ByFN/Fn27KlAXOuViqlPm/yAAdpPCuNXRQNGz/TemC4EAoGAA1gAAEAAACAAABAAAAgAAAQCAAABAAAAgAAAQAAAIAAAEAAACAAABAIAAAEAAACAAABAAAAgAAAQAAAIAAAEAgABI0ppdgF8oCYCeWi6Xa0IAv7AgAPrtkl2A1/oHAdDvUUDuXnL2BHYVv4wSCYD+h8CMEMCO4r+QfxAA6YTAROZ87I1klXog+LwpfrHPfkkmBAr3Ips81nzoXobslWSsXPuXu/4DAZBmGKwzviEAUwCAAABAAAAgAAAko4+LgLLaucqeF7n+/cr/90Vfx3QDEADdJcX+kD1/xfXi1x2v0a/FxhoK8jqka4AAsF30N25b1Cn4bfq1WK6bBMLIvZy47YgwAAFgZ2gvZ7JdasFG495/pSEzd2EgIXDKVAEEQHuFL0f76xBH+xphIKGzcEEgAXBOEIAAaI4U3zz2Ef+NQSBrDIUGwZXbRtYb133WA/dylv214JmS0krf2WqTkfafNn3bHFD33Af6n8HGk0abadFZLa4LHRE0ZfKe/aHF/9iFoIp04Ji1MWJ8Rwjcttw2MsWdWDwPIM+er1gqLPcwvaLqs+5Ii84TLP5SC//YavFr35Fvq6TvtHnDFukbU2sBII03s9x42w2ZPV9mmxv8eKkV/0pHSXlXPrAeRCYaXG04tBIAZdcar9KIpV5vz+232h3yTzSQu9Z/ijZHkgNDxV90uQdqms+oxeanjNaH/G/oO2sdCaxSC4Cyq8n9QkPmhEDjxT/rSd8p2wiBAcVPCFD86YZAm+cBRCl+/Z5etk9uk6/CRvq6sa5sv7mtCP05JATc55Dff0adRrGKUfyVa0I+VfrN9mLqZqr6TQu1CDn9kPdyn0NC4PetfturAJiFLDq3w6bu5TB7Pnf/V4bZ1vn97uc3pxnfhPpc7n3m2qGOqNegNvPlkEUv/ecke9t1H+OtV3kP6TN3OiopA4bAY+wQaCMA8hCr/ZWz3E4D7KQD7QRT976FBkGIO+jO9AgypG6DCbLgpyfjnGq7+xrpduXeV/q29/UqciBy7zXPnk8Y6s0agOyUeaAjvgyRziMkpCT7vfsdj9pJfOd0rAeEc+k7QpMDh9ukqL4HKv5t8p7f9UxR76lkFvlW7k0HgNdJPtp4j5qKsedH4xANqV9vXlO7Qeb9F57Ff6QHjmnkzyp989z9vt99DyJ6ACljBkDR4NC/8Gi8kTbeuOGOd66jAZ/Aucy4DXeI6ZRP8csFOPcNHDiqhnoQqR04esCcxwyAJs5g8/ojdAc+Ntx426OB2iGgjciZgn4Hj5VH/5ERY5vfyNxqAPlMBWIcqMtBQ0PUm7pDfy3+2xaLf2PkGQJ5w6OAu54Uv1d4avFPDfwdZ/pZfEaRoT0MtHPOI841yroBU7ls0gqvEGhyFNCjJwPndVfUDRX/xrTudKD6aLeA+zXf27HTxoHn2as6X6lpkTVyMkQNci/C45qd8qLJQtAQPUotANzfLUP+K6N/U61rXwK25WIzpdqz2uq62j823DHlbjOs7tvsO1Io341Paz5YuIBpYLQBzzL7994717PIYM+t8c93YOUzDgwW/9N3qB3oZAeGh5gpH/1litWFm6Ec6XSbANhyFnje/3TBRmUr+9aI+OngcRp4qF5sbUFHkW3vs/2eNuA6e15x3/ngEB26b84D9w2b06y5k6nwuhDtKXK33b20UBfwWRFjOYC0eTOcPWMB4Lty+/Sd8VsX5zRwZC7mu7L6wdrtpxMdAci3RkPP0eKbr1TV0Z/v2YWt3tfA2hTgxLP4J+9Zmdf7+cnXeb4NwCW/7Re/71WXUoif33PGoR65P2R+N/CYep5m3o8A0GH5yLP4azWEnjTjc771CSXY6YPHou5RONBdfI6SDwDP+ZT3ZaI6cqh76eWozRSHV/9Z+44AA1z2/YUAqL8TioAn5PiMAkbUYKvq7v/LQHfxkQPQZdf6jqUAqDt/uwn1ASqPCW96BAO/6WPto3/gZ1HkBECzQ7gy0K27qh5q/tzfKcXOHTyC9h09gBQ1Q2yUegDUEeP2yUXNn2MK0L0AeIjwWb7V/LkDAsBAAOh8sKSmklB2oU8SAC/7o0MjCxgT6aE0JQHQnFjz7jHl0X+R5t0HBEBzRhE6Bd/ns3Zgqk+mEgB1hk4xjtR135NpQ3vq7vsYJ+B8abD/9yoAajWizy2XX3BY8+f+oA47dfAQQU/BrTxb8N3aekhu5wMgC3j9d+U5cXUU1GE7PC6nHQY+gJw33Pd7FQC/1Z1z6WXEIfjcpokpQDcPIFch1n10QXFKANTncwS98l3R1VtJ1Z7/W7jBY+Lq9h8p/nvPvuP7Hg/JB4CeRumThLUf5qnF73N7pjvqr3U+bSB35rmvMxLQaaPcwXrY0sGvNyMA4XNhjzTeux7mKY0nDZ/535ttQf21fgCRg8fa4y2O9CAyfkf/kZ+R24/7jD7zNkeP1m4JFuphIGsNk8WuW3UFfjZ8q7d0wk/tKu0Z4nbbEuh3uy400z4qhX+ShfkaesI9AcMOx3eFQTUExoE/cqsNiCgHkCoZWZSVUWbIE33kXhaTNveZxTMBr7OwJ0UMtejHEYo/p/hNTQNiPEp7VOk7oc/ya/2J0YNEGjEGHvltMwTyrBtfyZo4eAwMN6L1I+sltwI3y/qazNrKQc7yxUDHmd1LK3MeDGp6FLAyHgLHVs4bGRhuxM3tlq2FwKojUxSmAvXv0Rd1dNLWef+77FlvSP3KTk60ODBS/BPO+usO13/ka8GpoeI3FUp7HWlECyFA8RMCvSp+8bcuNOCPHz/+8/Hjx3+5f/6jpRBYWJq34d3958H1HznYjVv49dJn/mmx+DszAqgkeaiHeb6n8S5Z8OvNSGCs/WfY4KjR1Jy/0wFQaUgJgKvIDVlo460pnV6FgBxE5EzTs4i/Rg4cN67vXFjfH3sdb8ypNuYwcOFfcoZf74NgqH1nGrrw3XbdleniXk8aU0YEhzo1qLNGsNZ5/g1H/CRHBBICcnFP3VN9pe/INf2Lrq0T7fWwQcfakJ8qI4NxpdDXlfmZ3IWooOhRCYNN/9nc3LN6AdDmwqBy03cybgYDAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBi/i/AAMsovPsxI1iAAAAAAElFTkSuQmCC",
                    //"image": null,
                    "is_old": false,
                    "url": "",
                    "car_type": "",
                    "driver_id": "2772",
                    "driver_login_id": "27722772",
                    "transport_route_name": "白河実業高校"
                }
            };
            datas.push(data);

            routes = [];
            var geo_json = JSON.parse('{ "features": [ { "type": "Feature", "properties": {}, "geometry": { "coordinates": [ [ 140.298591, 37.207301 ], [ 140.301592, 37.210196 ], [ 140.298847, 37.207147 ], [ 140.301802, 37.209915 ], [ 140.299147, 37.206977 ], [ 140.302066, 37.209662 ], [ 140.299438, 37.206794 ], [ 140.302286, 37.209406 ], [ 140.299708, 37.206596 ], [ 140.302564, 37.20913 ], [ 140.300052, 37.20642 ], [ 140.302782, 37.208835 ], [ 140.300345, 37.206223 ], [ 140.302977, 37.208582 ], [ 140.300704, 37.206024 ], [ 140.303187, 37.208291 ], [ 140.301043, 37.205862 ], [ 140.303431, 37.207862 ], [ 140.301363, 37.20569 ], [ 140.30363, 37.207483 ], [ 140.30168, 37.205521 ], [ 140.303852, 37.207045 ], [ 140.302064, 37.205247 ], [ 140.303999, 37.206573 ], [ 140.302466, 37.205053 ], [ 140.304187, 37.206152 ], [ 140.302812, 37.20488 ], [ 140.304357, 37.205676 ], [ 140.303277, 37.204779 ], [ 140.304258, 37.204579 ], [ 140.306109, 37.202488 ], [ 140.305858, 37.201757 ], [ 140.306013, 37.201381 ], [ 140.304187, 37.200896 ], [ 140.302215, 37.200769 ], [ 140.301728, 37.200538 ], [ 140.300113, 37.198649 ], [ 140.29872, 37.197405 ], [ 140.297959, 37.19682 ], [ 140.297251, 37.19664 ], [ 140.29772, 37.19572 ], [ 140.298394, 37.195714 ], [ 140.29811, 37.196384 ], [ 140.299189, 37.195664 ], [ 140.2998, 37.195613 ], [ 140.298756, 37.196642 ], [ 140.300248, 37.195952 ], [ 140.299631, 37.197113 ], [ 140.300708, 37.196154 ], [ 140.303154, 37.195214 ], [ 140.303658, 37.194831 ], [ 140.304081, 37.194117 ], [ 140.304623, 37.194319 ], [ 140.303867, 37.195473 ], [ 140.30094, 37.196593 ], [ 140.301553, 37.197363 ], [ 140.301085, 37.197603 ], [ 140.30047, 37.196793 ], [ 140.300136, 37.197097 ], [ 140.300651, 37.197806 ], [ 140.300004, 37.197726 ], [ 140.302256, 37.200318 ], [ 140.303955, 37.200395 ], [ 140.306686, 37.201105 ], [ 140.306371, 37.20179 ], [ 140.3066, 37.202589 ], [ 140.304585, 37.205392 ], [ 140.303481, 37.204637 ], [ 140.30549, 37.202427 ], [ 140.305202, 37.201591 ], [ 140.304104, 37.201321 ], [ 140.302275, 37.201255 ], [ 140.301498, 37.200949 ], [ 140.300884, 37.200385 ], [ 140.29966, 37.198821 ], [ 140.297711, 37.197091 ], [ 140.296686, 37.196697 ], [ 140.29675, 37.196247 ], [ 140.297168, 37.195313 ], [ 140.30002, 37.19512 ], [ 140.300346, 37.195553 ], [ 140.302823, 37.194816 ], [ 140.303631, 37.193932 ], [ 140.300077, 37.192445 ], [ 140.299623, 37.191796 ], [ 140.300549, 37.190105 ], [ 140.301618, 37.189077 ], [ 140.303603, 37.187862 ], [ 140.305706, 37.187023 ], [ 140.308346, 37.186492 ], [ 140.309909, 37.186281 ], [ 140.310003, 37.186836 ], [ 140.306744, 37.187337 ], [ 140.305127, 37.187829 ], [ 140.302901, 37.188983 ], [ 140.301083, 37.190761 ], [ 140.300424, 37.192136 ], [ 140.298666, 37.191691 ], [ 140.299543, 37.189975 ], [ 140.300975, 37.188477 ], [ 140.302963, 37.18729 ], [ 140.305817, 37.186317 ], [ 140.309792, 37.18567 ], [ 140.310107, 37.186318 ], [ 140.310787, 37.186313 ], [ 140.31266, 37.18658 ], [ 140.317078, 37.187584 ], [ 140.31859, 37.187794 ], [ 140.324865, 37.188087 ], [ 140.32588, 37.188182 ], [ 140.3287, 37.188753 ], [ 140.331151, 37.18964 ], [ 140.332061, 37.190034 ], [ 140.335499, 37.191704 ], [ 140.337295, 37.192535 ], [ 140.33883, 37.193107 ], [ 140.340549, 37.19351 ], [ 140.342033, 37.193652 ], [ 140.345902, 37.193781 ], [ 140.348146, 37.194017 ], [ 140.349991, 37.194473 ], [ 140.351909, 37.19529 ], [ 140.352913, 37.195894 ], [ 140.356728, 37.198623 ], [ 140.358079, 37.19933 ], [ 140.359617, 37.199906 ], [ 140.361125, 37.200263 ], [ 140.362644, 37.200453 ], [ 140.366379, 37.200431 ], [ 140.368201, 37.200501 ], [ 140.369804, 37.200785 ], [ 140.371264, 37.201179 ], [ 140.372867, 37.201815 ], [ 140.375053, 37.203257 ], [ 140.378117, 37.205455 ], [ 140.379754, 37.206322 ], [ 140.381463, 37.206962 ], [ 140.385241, 37.207604 ], [ 140.386978, 37.207633 ], [ 140.389885, 37.207448 ], [ 140.391769, 37.207237 ], [ 140.393855, 37.206893 ], [ 140.394014, 37.207502 ], [ 140.388489, 37.208289 ], [ 140.383534, 37.208163 ], [ 140.381001, 37.207631 ], [ 140.37763, 37.206172 ], [ 140.373421, 37.203271 ], [ 140.374638, 37.201998 ], [ 140.378625, 37.204902 ], [ 140.381783, 37.206307 ], [ 140.38547, 37.206981 ], [ 140.389795, 37.206869 ], [ 140.393673, 37.206344 ], [ 140.394252, 37.206769 ], [ 140.404218, 37.204635 ], [ 140.411866, 37.203118 ], [ 140.415986, 37.202436 ], [ 140.420987, 37.202018 ], [ 140.42615, 37.202029 ], [ 140.438455, 37.202904 ], [ 140.438063, 37.203429 ], [ 140.426302, 37.202767 ], [ 140.421038, 37.202684 ], [ 140.416135, 37.203104 ], [ 140.412517, 37.203661 ], [ 140.412298, 37.202314 ], [ 140.415963, 37.20171 ], [ 140.42091, 37.201303 ], [ 140.426203, 37.201291 ], [ 140.43215, 37.201571 ], [ 140.436936, 37.20187 ], [ 140.438199, 37.202315 ], [ 140.439203, 37.202935 ], [ 140.442073, 37.203182 ], [ 140.447457, 37.203356 ], [ 140.450655, 37.202733 ], [ 140.450989, 37.202156 ], [ 140.447486, 37.202823 ], [ 140.444105, 37.202701 ], [ 140.444119, 37.203796 ], [ 140.447411, 37.203865 ], [ 140.451382, 37.203092 ], [ 140.451257, 37.202625 ], [ 140.455911, 37.201329 ], [ 140.459237, 37.200319 ], [ 140.46188, 37.199627 ], [ 140.466691, 37.199526 ], [ 140.470059, 37.200378 ], [ 140.473942, 37.201533 ], [ 140.477467, 37.202533 ], [ 140.48121, 37.203389 ], [ 140.488471, 37.203298 ], [ 140.494096, 37.203664 ], [ 140.497786, 37.203844 ], [ 140.501169, 37.20383 ], [ 140.506068, 37.203191 ], [ 140.510125, 37.20333 ], [ 140.513716, 37.204384 ], [ 140.517314, 37.204853 ], [ 140.519164, 37.20532 ], [ 140.518889, 37.205942 ], [ 140.509981, 37.204106 ], [ 140.506132, 37.203708 ], [ 140.501329, 37.204545 ], [ 140.488352, 37.204103 ], [ 140.488251, 37.203418 ], [ 140.484847, 37.203502 ], [ 140.484668, 37.20403 ], [ 140.481076, 37.204135 ], [ 140.466697, 37.200026 ], [ 140.46713, 37.198987 ], [ 140.481301, 37.202813 ], [ 140.484771, 37.20276 ], [ 140.484801, 37.203263 ], [ 140.488303, 37.203216 ], [ 140.488355, 37.202552 ], [ 140.497707, 37.202877 ], [ 140.500835, 37.20294 ], [ 140.506035, 37.202339 ], [ 140.51023, 37.202637 ], [ 140.514069, 37.203696 ], [ 140.517526, 37.20414 ], [ 140.519459, 37.20467 ], [ 140.519488, 37.205355 ], [ 140.52646, 37.207236 ], [ 140.528617, 37.207857 ], [ 140.5315, 37.208547 ], [ 140.534631, 37.209149 ], [ 140.53641, 37.209602 ], [ 140.537827, 37.210249 ], [ 140.539177, 37.211054 ], [ 140.540134, 37.212395 ], [ 140.541382, 37.215138 ], [ 140.543661, 37.220447 ], [ 140.544235, 37.219971 ], [ 140.540562, 37.211199 ], [ 140.539001, 37.2117 ], [ 140.541174, 37.216897 ], [ 140.541961, 37.218657 ], [ 140.542773, 37.22068 ], [ 140.543691, 37.220754 ], [ 140.545637, 37.225172 ], [ 140.546658, 37.226385 ], [ 140.547878, 37.227418 ], [ 140.551451, 37.229222 ], [ 140.553044, 37.230429 ], [ 140.554421, 37.231809 ], [ 140.555273, 37.233134 ], [ 140.556127, 37.234875 ], [ 140.556486, 37.235962 ], [ 140.556682, 37.237723 ], [ 140.556636, 37.241047 ], [ 140.557057, 37.242748 ], [ 140.559469, 37.247097 ], [ 140.561136, 37.249884 ], [ 140.561849, 37.251477 ], [ 140.562668, 37.252987 ], [ 140.564034, 37.255917 ], [ 140.565595, 37.258907 ], [ 140.568512, 37.262725 ], [ 140.570743, 37.264597 ], [ 140.575281, 37.266998 ], [ 140.574867, 37.267416 ], [ 140.570157, 37.265025 ], [ 140.567852, 37.262999 ], [ 140.567598, 37.26266 ], [ 140.568787, 37.262018 ], [ 140.571228, 37.264155 ], [ 140.575847, 37.26657 ], [ 140.575631, 37.267082 ], [ 140.579743, 37.268566 ], [ 140.582766, 37.269425 ], [ 140.590188, 37.272312 ], [ 140.594213, 37.274433 ], [ 140.593672, 37.27505 ], [ 140.58951, 37.272894 ], [ 140.580145, 37.269359 ], [ 140.580755, 37.267988 ], [ 140.590894, 37.271732 ], [ 140.594621, 37.273803 ], [ 140.594742, 37.27471 ], [ 140.59842, 37.27827 ], [ 140.599429, 37.2796 ], [ 140.601847, 37.282998 ], [ 140.601439, 37.283505 ], [ 140.598242, 37.279166 ], [ 140.59644, 37.27728 ], [ 140.597849, 37.276569 ], [ 140.599772, 37.278486 ], [ 140.602796, 37.283031 ], [ 140.602151, 37.283401 ], [ 140.605668, 37.28903 ], [ 140.608188, 37.291854 ], [ 140.611086, 37.293731 ], [ 140.612537, 37.294327 ], [ 140.612961, 37.294503 ], [ 140.613301, 37.294667 ], [ 140.613824, 37.294835 ], [ 140.614374, 37.295041 ], [ 140.615412, 37.295289 ], [ 140.616134, 37.295481 ], [ 140.616911, 37.295677 ], [ 140.618899, 37.2952 ], [ 140.619965, 37.294591 ], [ 140.62021, 37.293764 ], [ 140.619727, 37.292862 ], [ 140.618917, 37.292134 ], [ 140.617144, 37.291224 ], [ 140.61337, 37.289966 ], [ 140.614462, 37.289564 ], [ 140.617601, 37.290571 ], [ 140.619608, 37.291626 ], [ 140.620492, 37.292455 ], [ 140.621199, 37.293669 ], [ 140.62099, 37.294972 ], [ 140.619442, 37.295906 ], [ 140.61681, 37.296435 ], [ 140.612456, 37.295014 ], [ 140.613144, 37.294177 ], [ 140.617089, 37.294863 ], [ 140.619093, 37.294265 ], [ 140.619216, 37.293693 ], [ 140.618382, 37.292703 ], [ 140.616748, 37.291883 ], [ 140.613235, 37.290714 ], [ 140.611889, 37.289927 ], [ 140.612879, 37.286483 ], [ 140.614, 37.286432 ], [ 140.613643, 37.288516 ], [ 140.614265, 37.289401 ], [ 140.613151, 37.28963 ], [ 140.612888, 37.288455 ], [ 140.613714, 37.285477 ], [ 140.615787, 37.282763 ], [ 140.618521, 37.280537 ], [ 140.621228, 37.27801 ], [ 140.624205, 37.275443 ], [ 140.62693, 37.273405 ], [ 140.629973, 37.271425 ], [ 140.633301, 37.269721 ], [ 140.641035, 37.267241 ], [ 140.64428, 37.265324 ], [ 140.646678, 37.262748 ], [ 140.648361, 37.259294 ], [ 140.650328, 37.256286 ], [ 140.653555, 37.254069 ], [ 140.657571, 37.252075 ], [ 140.660499, 37.249436 ], [ 140.663621, 37.24693 ], [ 140.667507, 37.24537 ], [ 140.671061, 37.243856 ], [ 140.674, 37.24165 ], [ 140.676208, 37.239307 ], [ 140.67788, 37.236692 ], [ 140.679124, 37.233642 ], [ 140.681473, 37.230813 ], [ 140.683344, 37.22815 ], [ 140.684841, 37.225174 ], [ 140.687438, 37.222463 ], [ 140.689994, 37.219729 ], [ 140.691059, 37.216593 ], [ 140.691149, 37.213294 ], [ 140.692472, 37.20983 ], [ 140.694223, 37.207009 ], [ 140.695148, 37.203687 ], [ 140.696635, 37.20097 ], [ 140.699117, 37.198648 ], [ 140.702258, 37.196312 ], [ 140.705045, 37.193757 ], [ 140.707024, 37.190964 ], [ 140.708537, 37.18822 ], [ 140.710296, 37.185287 ], [ 140.712387, 37.182857 ], [ 140.715079, 37.180608 ], [ 140.718, 37.178432 ], [ 140.720529, 37.176269 ], [ 140.722177, 37.174295 ], [ 140.722751, 37.174539 ], [ 140.722597, 37.175702 ], [ 140.721512, 37.176885 ], [ 140.720413, 37.177101 ], [ 140.719382, 37.176646 ], [ 140.721211, 37.174763 ], [ 140.721565, 37.174193 ], [ 140.722307, 37.173974 ], [ 140.723561, 37.171532 ], [ 140.723942, 37.170306 ], [ 140.725448, 37.1672 ], [ 140.727967, 37.164693 ], [ 140.73081, 37.162112 ], [ 140.732095, 37.159343 ], [ 140.732946, 37.156493 ], [ 140.734826, 37.153886 ], [ 140.737549, 37.152012 ], [ 140.74006, 37.150199 ], [ 140.74181, 37.147676 ], [ 140.743928, 37.145031 ], [ 140.746722, 37.142859 ], [ 140.750315, 37.13742 ], [ 140.75267, 37.13456 ], [ 140.753396, 37.132945 ], [ 140.75392, 37.13133 ], [ 140.754091, 37.12812 ], [ 140.752043, 37.120947 ], [ 140.75169, 37.117567 ], [ 140.751741, 37.116199 ], [ 140.752585, 37.116094 ], [ 140.752545, 37.117477 ], [ 140.753009, 37.120792 ], [ 140.755201, 37.128508 ], [ 140.753143, 37.128752 ], [ 140.750939, 37.121033 ], [ 140.750711, 37.117566 ], [ 140.750685, 37.116231 ], [ 140.751768, 37.115834 ], [ 140.752713, 37.113547 ], [ 140.753928, 37.112157 ], [ 140.75525, 37.111105 ], [ 140.758304, 37.109303 ], [ 140.761707, 37.107901 ], [ 140.765334, 37.10623 ], [ 140.767014, 37.104991 ], [ 140.768253, 37.103853 ], [ 140.769437, 37.102559 ], [ 140.772335, 37.098858 ], [ 140.77362, 37.097824 ], [ 140.775158, 37.097042 ], [ 140.77908, 37.096038 ], [ 140.781099, 37.095302 ], [ 140.782866, 37.094415 ], [ 140.785239, 37.092754 ], [ 140.786665, 37.091143 ], [ 140.78729, 37.089936 ], [ 140.787763, 37.0883 ], [ 140.787621, 37.086552 ], [ 140.787448, 37.085457 ], [ 140.788389, 37.085401 ], [ 140.78856, 37.08648 ], [ 140.788637, 37.088314 ], [ 140.787985, 37.090145 ], [ 140.78736, 37.091387 ], [ 140.785817, 37.090776 ], [ 140.786496, 37.08969 ], [ 140.786931, 37.088291 ], [ 140.78658, 37.085529 ], [ 140.787446, 37.085104 ], [ 140.787428, 37.084075 ], [ 140.787853, 37.082614 ], [ 140.788334, 37.081678 ], [ 140.789696, 37.079824 ], [ 140.790789, 37.078138 ], [ 140.791288, 37.076595 ], [ 140.791442, 37.075181 ], [ 140.791365, 37.072139 ], [ 140.791724, 37.070126 ], [ 140.792237, 37.068664 ], [ 140.793921, 37.065999 ], [ 140.795899, 37.063614 ], [ 140.796579, 37.062647 ], [ 140.797528, 37.060945 ], [ 140.798971, 37.058143 ], [ 140.800508, 37.056184 ], [ 140.802197, 37.05444 ], [ 140.803754, 37.052674 ], [ 140.805312, 37.050154 ], [ 140.807126, 37.046366 ], [ 140.807982, 37.044971 ], [ 140.809053, 37.043667 ], [ 140.810162, 37.042626 ], [ 140.811303, 37.041679 ], [ 140.812536, 37.040879 ], [ 140.814724, 37.039723 ], [ 140.816959, 37.038714 ], [ 140.817662, 37.038666 ], [ 140.818368, 37.039102 ], [ 140.818909, 37.039784 ], [ 140.82023, 37.042343 ], [ 140.820567, 37.043997 ], [ 140.821015, 37.046889 ], [ 140.821387, 37.048509 ], [ 140.822009, 37.049961 ], [ 140.822827, 37.051284 ], [ 140.824029, 37.052423 ], [ 140.826402, 37.054351 ], [ 140.828887, 37.056452 ], [ 140.830122, 37.057612 ], [ 140.831205, 37.059186 ], [ 140.832829, 37.062659 ], [ 140.833391, 37.063328 ], [ 140.83798, 37.066884 ], [ 140.839101, 37.068169 ], [ 140.840114, 37.069672 ], [ 140.841089, 37.072284 ], [ 140.842149, 37.086481 ], [ 140.842754, 37.088619 ], [ 140.841465, 37.088399 ], [ 140.840202, 37.072331 ], [ 140.83923, 37.069902 ], [ 140.841028, 37.069505 ], [ 140.841978, 37.072234 ], [ 140.843175, 37.086442 ], [ 140.843868, 37.088521 ], [ 140.84293, 37.089001 ], [ 140.843549, 37.090268 ], [ 140.844834, 37.092313 ], [ 140.846393, 37.09383 ], [ 140.847549, 37.094594 ], [ 140.848775, 37.095182 ], [ 140.850507, 37.095813 ], [ 140.852365, 37.096093 ], [ 140.859883, 37.096337 ], [ 140.863486, 37.096484 ], [ 140.865527, 37.09661 ], [ 140.867417, 37.096857 ], [ 140.869276, 37.097433 ], [ 140.870758, 37.09821 ], [ 140.872032, 37.099283 ], [ 140.872993, 37.100458 ], [ 140.87494, 37.103407 ], [ 140.876191, 37.104482 ], [ 140.877506, 37.105308 ], [ 140.879363, 37.105935 ], [ 140.881346, 37.106362 ], [ 140.883366, 37.106735 ], [ 140.885184, 37.10719 ], [ 140.887149, 37.107845 ], [ 140.890246, 37.109428 ], [ 140.892024, 37.110859 ], [ 140.893288, 37.112134 ], [ 140.895168, 37.114403 ], [ 140.895784, 37.11503 ], [ 140.896913, 37.115913 ], [ 140.897939, 37.116509 ], [ 140.898997, 37.116923 ], [ 140.900493, 37.117332 ], [ 140.901821, 37.117508 ], [ 140.902934, 37.117517 ], [ 140.905049, 37.117209 ], [ 140.908015, 37.116684 ], [ 140.909225, 37.116524 ], [ 140.910983, 37.116468 ], [ 140.91218, 37.116566 ], [ 140.913691, 37.116822 ], [ 140.916179, 37.117706 ], [ 140.917807, 37.118538 ], [ 140.919445, 37.119765 ], [ 140.921002, 37.120664 ], [ 140.923004, 37.121509 ], [ 140.925262, 37.121924 ], [ 140.927512, 37.122072 ], [ 140.931619, 37.122086 ], [ 140.935252, 37.122571 ], [ 140.938939, 37.123591 ], [ 140.940791, 37.124269 ], [ 140.942442, 37.12519 ], [ 140.945645, 37.12718 ], [ 140.948254, 37.129081 ], [ 140.951075, 37.131196 ], [ 140.954158, 37.133559 ], [ 140.956721, 37.135663 ], [ 140.960007, 37.138526 ], [ 140.962301, 37.141474 ], [ 140.963986, 37.144585 ], [ 140.965267, 37.148703 ], [ 140.96588, 37.151593 ], [ 140.96629, 37.154909 ], [ 140.966502, 37.158086 ], [ 140.966576, 37.161115 ], [ 140.966608, 37.164162 ], [ 140.966876, 37.165827 ], [ 140.967348, 37.167453 ], [ 140.968214, 37.169319 ], [ 140.969334, 37.170985 ], [ 140.970774, 37.172587 ], [ 140.972558, 37.173991 ], [ 140.975886, 37.17641 ], [ 140.97728, 37.177722 ], [ 140.976684, 37.17817 ], [ 140.974979, 37.176725 ], [ 140.972028, 37.174518 ], [ 140.97048, 37.173258 ], [ 140.971868, 37.172311 ], [ 140.973426, 37.173548 ], [ 140.976825, 37.176155 ], [ 140.97823, 37.177502 ], [ 140.977464, 37.17786 ], [ 140.979166, 37.179833 ], [ 140.981377, 37.182497 ], [ 140.983197, 37.185077 ], [ 140.984723, 37.187868 ], [ 140.985854, 37.190925 ], [ 140.98645, 37.194049 ], [ 140.986453, 37.197144 ], [ 140.98605, 37.200128 ], [ 140.985067, 37.203213 ], [ 140.983528, 37.206403 ], [ 140.981784, 37.209352 ], [ 140.98015, 37.212259 ], [ 140.978602, 37.215195 ], [ 140.977405, 37.218334 ], [ 140.976707, 37.221439 ], [ 140.976908, 37.224273 ], [ 140.977674, 37.226933 ], [ 140.979221, 37.230057 ], [ 140.980956, 37.233169 ], [ 140.982325, 37.235752 ], [ 140.984026, 37.238646 ], [ 140.98573, 37.241764 ], [ 140.987244, 37.24445 ], [ 140.988768, 37.247261 ], [ 140.990016, 37.249802 ], [ 140.991068, 37.252476 ], [ 140.991506, 37.255625 ], [ 140.991159, 37.258832 ], [ 140.990197, 37.261546 ], [ 140.98868, 37.264254 ], [ 140.986759, 37.267063 ], [ 140.985065, 37.26969 ], [ 140.983618, 37.272384 ], [ 140.98251, 37.275072 ], [ 140.981738, 37.278234 ], [ 140.981353, 37.281231 ], [ 140.981417, 37.284681 ], [ 140.982178, 37.28869 ], [ 140.981762, 37.288734 ], [ 140.980976, 37.287891 ], [ 140.980714, 37.286491 ], [ 140.981085, 37.285651 ], [ 140.981854, 37.285499 ], [ 140.982503, 37.288664 ], [ 140.982194, 37.288943 ], [ 140.982784, 37.290901 ], [ 140.983972, 37.293814 ], [ 140.985463, 37.296444 ], [ 140.987449, 37.29919 ], [ 140.989138, 37.301831 ], [ 140.990564, 37.30464 ], [ 140.991644, 37.307543 ], [ 140.992415, 37.310172 ], [ 140.992768, 37.312861 ], [ 140.992417, 37.315729 ], [ 140.991034, 37.321548 ], [ 140.990585, 37.324362 ], [ 140.990335, 37.327375 ], [ 140.990299, 37.330371 ], [ 140.990472, 37.33341 ], [ 140.990721, 37.336724 ], [ 140.990468, 37.339895 ], [ 140.989503, 37.342912 ], [ 140.987718, 37.345874 ], [ 140.985245, 37.348453 ], [ 140.982265, 37.35061 ], [ 140.978553, 37.353024 ], [ 140.975542, 37.355286 ], [ 140.972909, 37.357982 ], [ 140.970534, 37.361442 ], [ 140.969014, 37.364365 ], [ 140.967804, 37.367339 ], [ 140.967015, 37.370521 ], [ 140.966112, 37.374615 ], [ 140.96541, 37.375053 ], [ 140.964904, 37.374671 ], [ 140.965166, 37.371827 ], [ 140.965164, 37.370698 ], [ 140.967405, 37.370463 ], [ 140.966402, 37.374963 ], [ 140.965384, 37.375378 ], [ 140.96482, 37.375165 ], [ 140.964614, 37.374801 ], [ 140.964953, 37.370132 ], [ 140.965781, 37.37007 ], [ 140.965318, 37.374596 ], [ 140.965741, 37.374598 ], [ 140.966183, 37.370054 ], [ 140.968454, 37.36983 ], [ 140.968559, 37.370763 ], [ 140.967453, 37.3709 ], [ 140.967841, 37.370373 ], [ 140.973051, 37.369863 ], [ 140.975654, 37.36957 ], [ 140.978227, 37.369118 ], [ 140.980694, 37.368625 ], [ 140.981932, 37.368468 ], [ 140.984983, 37.368208 ], [ 140.989181, 37.368194 ], [ 140.991619, 37.368147 ], [ 140.991611, 37.368984 ], [ 141.000282, 37.36682 ], [ 140.991307, 37.369306 ], [ 141.000323, 37.367325 ], [ 140.991267, 37.369809 ], [ 141.000564, 37.367855 ], [ 140.99126, 37.370313 ], [ 141.000729, 37.36829 ], [ 140.991229, 37.370748 ], [ 141.000925, 37.368736 ], [ 140.991209, 37.37115 ], [ 141.001107, 37.369153 ], [ 140.991183, 37.371539 ], [ 141.00126, 37.369595 ], [ 140.9911, 37.371992 ], [ 141.001388, 37.370034 ], [ 140.991021, 37.372331 ], [ 141.001579, 37.370473 ], [ 140.990837, 37.372752 ], [ 141.001751, 37.370968 ], [ 140.990863, 37.373198 ], [ 141.001971, 37.371442 ], [ 140.990944, 37.37364 ], [ 141.002131, 37.371988 ], [ 140.991025, 37.37421 ], [ 141.002319, 37.372488 ], [ 140.991206, 37.374736 ], [ 141.002454, 37.373066 ], [ 140.991347, 37.375294 ], [ 141.00262, 37.373487 ], [ 140.991458, 37.375752 ], [ 141.002812, 37.374078 ], [ 140.991702, 37.376375 ], [ 141.00297, 37.374645 ], [ 140.992018, 37.376965 ], [ 141.002183, 37.37085 ], [ 141.003237, 37.370699 ], [ 141.004582, 37.371392 ], [ 141.005194, 37.371601 ], [ 141.00604, 37.371666 ], [ 141.009201, 37.371585 ], [ 141.009138, 37.373657 ], [ 141.008995, 37.375847 ], [ 141.008947, 37.378007 ], [ 141.008715, 37.382535 ], [ 141.008522, 37.386975 ], [ 141.007327, 37.390942 ], [ 141.006341, 37.39312 ], [ 141.004551, 37.395011 ], [ 141.003147, 37.396348 ], [ 141.002412, 37.397247 ], [ 141.002111, 37.398136 ], [ 141.005074, 37.39842 ], [ 141.005001, 37.398694 ], [ 141.00207, 37.39839 ], [ 141.001586, 37.399858 ], [ 140.999154, 37.403452 ], [ 140.997637, 37.405448 ], [ 140.997073, 37.407141 ], [ 140.996922, 37.408617 ], [ 140.997233, 37.410179 ], [ 140.996549, 37.413428 ], [ 140.996093, 37.414556 ], [ 140.997293, 37.415462 ], [ 140.99651, 37.41839 ], [ 140.997549, 37.418659 ], [ 140.998482, 37.415335 ], [ 140.999146, 37.416772 ], [ 140.998728, 37.418865 ], [ 141.000032, 37.419291 ], [ 141.000312, 37.417518 ], [ 141.000719, 37.418269 ], [ 141.002499, 37.421011 ], [ 141.009067, 37.43097 ], [ 141.012678, 37.430813 ], [ 141.017733, 37.430264 ], [ 141.009927, 37.430422 ], [ 141.009259, 37.429626 ], [ 141.019779, 37.429468 ], [ 141.020507, 37.428491 ], [ 141.00881, 37.428528 ], [ 141.008108, 37.427514 ], [ 141.020779, 37.427416 ], [ 141.020971, 37.426298 ], [ 141.007637, 37.426507 ], [ 141.006852, 37.425569 ], [ 141.021205, 37.425352 ], [ 141.024586, 37.424574 ], [ 141.006404, 37.424655 ], [ 141.005556, 37.423651 ], [ 141.024478, 37.423712 ], [ 141.024605, 37.422736 ], [ 141.004989, 37.422695 ], [ 141.004242, 37.421586 ], [ 141.02437, 37.42175 ], [ 141.024365, 37.420762 ], [ 141.003572, 37.420644 ], [ 141.002951, 37.419642 ], [ 141.023946, 37.419701 ], [ 141.023811, 37.418398 ], [ 141.002292, 37.418349 ], [ 141.001417, 37.417015 ], [ 141.026089, 37.417091 ], [ 141.034819, 37.416068 ], [ 141.001331, 37.4159 ], [ 141.000487, 37.414103 ], [ 141.035164, 37.41432 ], [ 141.035326, 37.413035 ], [ 141.000367, 37.412754 ], [ 140.999496, 37.4112 ], [ 141.035434, 37.411409 ], [ 141.035326, 37.409653 ], [ 140.998657, 37.409568 ], [ 140.998543, 37.407808 ], [ 141.03538, 37.408069 ], [ 141.035434, 37.406228 ], [ 140.998716, 37.406231 ], [ 140.999789, 37.404456 ], [ 141.035541, 37.404643 ], [ 141.035434, 37.403145 ], [ 141.000996, 37.402985 ], [ 141.002065, 37.40129 ], [ 141.035373, 37.401482 ], [ 141.035446, 37.399756 ], [ 141.003085, 37.399544 ], [ 141.003601, 37.398005 ], [ 141.035811, 37.398141 ], [ 141.035911, 37.396479 ], [ 141.004093, 37.396626 ], [ 141.006131, 37.394847 ], [ 141.035908, 37.394951 ], [ 141.035911, 37.393607 ], [ 141.007142, 37.393161 ], [ 141.008038, 37.391546 ], [ 141.035928, 37.391874 ], [ 141.036035, 37.390522 ], [ 141.008425, 37.390114 ], [ 141.008952, 37.388564 ], [ 141.035792, 37.388926 ], [ 141.03556, 37.387293 ], [ 141.009276, 37.387217 ], [ 141.00947, 37.385584 ], [ 141.035121, 37.385537 ], [ 141.035191, 37.383948 ], [ 141.00972, 37.384038 ], [ 141.009753, 37.382526 ], [ 141.035213, 37.382459 ], [ 141.034926, 37.381002 ], [ 141.009892, 37.38116 ], [ 141.012143, 37.380007 ], [ 141.03462, 37.379475 ] ], "type": "LineString" }, "id": "88bc6e9be4b87fecd1f9ee50fdb2e270" } ], "type": "FeatureCollection"}');
            var route = {
                "id": 35,
                "name": "堰の上",
                "destination_id": 683,
                "geo_json": geo_json
            };
            routes.push(route);
    
            addImageMarker(datas);
            addSymbolMarker(datas);
            makeMapboxPopup('drivers');
            //addArrow(datas);
    
            addRoutes(routes);
        }
     
        var popup;
        function addImageMarker(datas) {
            // 画像がある場合は、画像をマーカーにする
            datas.forEach(function(marker) {
    
    		if(marker.properties.image != null){
    			    // create a DOM element for the marker
    			    var el = document.createElement('div');
    			    el.className = 'marker';
    			    el.style.backgroundImage = 'url('+ marker.properties.image +')';
    			    el.style.backgroundRepeat = 'no-repeat'; 
    			    el.style.width = '30px';
    			    el.style.height = '25px';
    			    
    			    // add marker to map
    			    new mapboxgl.Marker(el, {offset: [-30 / 2, -25 / 2]})
    			        .setLngLat(marker.geometry.coordinates)
    			        .addTo(map);
    			    
    			    el.addEventListener('click', function() {
    			    	if(typeof popup != 'undefined'){
    				  		popup.remove();
    				  	}
    			    	var url = "";
    			    	var anchor = "";
    			    	if(marker.properties.url != ""){
    			    		url = marker.properties.url + encodeURIComponent(marker.properties.car_type);
    			    		anchor = '<a href="' + url + '"target="_blank">' + "輸送情報</a></br>";
    			    	}
    			    	popup = new mapboxgl.Popup({closeOnClick: false})
    			    	.setLngLat(marker.geometry.coordinates)
    			    	.setHTML("ID：" + marker.properties.driver_id + "<br/>"
    			    				+ "ログインID：" + marker.properties.driver_login_id + "<br/>"
    			    				+ "運転手："+ marker.properties.name + "<br/>"
    						   		+ "車両："+ marker.properties.car_type + "<br/>"
    						   		+ "ルート名："+ marker.properties.transport_route_name + "<br/>"
    						   		+ marker.properties.status + "<br/>" 
    						   		+ anchor
    						   		+ "更新時刻:" + marker.properties.created)
    					.addTo(map);
    			    });
    			}});	
        }
        
        function addRoutes(routes) {
        	for (var i = 0; i < routes.length; i++){
        		//2番目の引数は輸送ルートのポリゴンに一意の名前をつけないといけないので
        		addRouteAndPopup(routes[i] , "transport_route" + i, routes[i].name);
        	}
        }
    
        function addRouteAndPopup(route, route_id, route_name, color = null) {
        	var hundredMeterOut = turf.buffer(route.geo_json, 100, 'meters');
        	hundredMeterOut.features[0].properties.name = route_name;

        	addPolygon(hundredMeterOut.features, route_id);
        	makeMapboxPopup(route_id);
        }
        
        function addPolygon(area, area_name, fillColor, outlineColor){
        	map.on('style.load', function() {
        		map.addSource(area_name, 
        				{
        					"type" : "geojson",
        					"data" : {
        						"type" : "FeatureCollection",
        						"features" : area
        					}
        				}
        		);
        	
        		map.addLayer({
        			"id" : area_name,
        			"type" : "fill",
        		     "source": area_name,
        		     "paint": {
        		    	 "fill-color": "#0000ff",
        		    	 "fill-opacity": 0.5,
        		    	 "fill-outline-color": "#0000ff"
        	            }
        	        },"drivers");
        	});
        }
        
        function makeMapboxPopup(layer_id){
    	    // ポップアップでの表示
        	map.on('click', function (e) {
    		   if(typeof isDriverMap !== "undefined"){
    			   // ドライバーマップではここでは何も表示しない。ドライバー情報はaddImageMarker.jsでonClickイベントで設定している。
    			   return;
    		   }
    	
    		   var features = map.queryRenderedFeatures(e.point, { layers: [layer_id] });
    		
    		   if (!features.length) {
    		       return;
    		   }
    	
    		   var feature = features[0];
    
    		   //輸送ルートの場合は、一つ一つレイヤーの名称が違う　transportで始まること
    		   if (layer_id.match(/^transport/)) {
    
    				   var popup = new mapboxgl.Popup()
    				       .setLngLat(e.lngLat)
    				       .setHTML(feature.properties.name)
    				       .addTo(map);
    				
    			}
    		   
    		   //ナビエリアの場合は、一つ一つレイヤーの名称が違う　areaで始まること
    		   if (layer_id.match(/^navi_area/)) {
    
    				   var popup = new mapboxgl.Popup()
    				       .setLngLat(e.lngLat)
    				       .setHTML(feature.properties.name)
    				       .addTo(map);
    				
    			}
    		   
    		   switch (layer_id){		   
    			   case 'destinations':  
    				   			   
    				   var info = '';
    				   if(feature.properties.information != "undefined"){
    					   info = feature.properties.information;
    				   }
    				   
    				   var popup = new mapboxgl.Popup()
    			       .setLngLat(feature.geometry.coordinates)
    			       .setHTML("<a href =\"" + feature.properties.url + "\">" + feature.properties.name + "</a><br>" + info)
    			       .addTo(map);
    				   
    				break;   
    				
    			   case 'driver_records':
    				   var deviatedMessage = "";
    				   if(feature.properties.is_deviated == "1"){
    					   deviatedMessage = '<span class="deviated">ルートを外れた位置情報です！</span><br>';
    				   }
    				   var popup = new mapboxgl.Popup()
    				       .setLngLat(feature.geometry.coordinates)
    				       .setHTML( deviatedMessage + feature.properties.status_ja + "<br>" + feature.properties.created)
    				       .addTo(map);
    				
    				break;
    		   }
    		});
        }
        
        function addSymbolMarker(datas){
        	map.on('style.load', function() {
    	
    			map.addSource("drivers", {
    				"type" : "geojson",
    				"data" : {
    					"type" : "FeatureCollection",
    					"features" : datas
    	
    				}
    			});
    			
    			map.addLayer({
    						"id" : "drivers",
    						"type" : "symbol",
    						"source" : "drivers",
    						"layout" : {
    							"icon-image" : "{image}",
    							"icon-size": 0.25,
                                "text-field" : "{name}",
    							"text-font" : [ "Open Sans Semibold",
    									"Arial Unicode MS Bold" ],
    							"text-offset" : [ 0, 1 ],
    							"text-size" : 10,
    							"text-anchor" : "top"
    						},
    	                    "paint": {
    	                        "text-color": "#023295",
    	                        "text-halo-color" : "#ffffff",
    	                        "text-halo-width" : 2
    	                    },
    					});
        		});
        }
*/
  </script>
</div>  

<!--
<form>
  <label>Say something:</label><br>
  <input type="text" data-behavior="room_speaker">
</form>
-->